---
interface Props {
  delay?: number; // Allow any number as delay
  class?: string;
  onlyWhenVisible?: boolean; // Whether to trigger animation only when element enters viewport
}

const { delay = 0, class: className = "", onlyWhenVisible = false } = Astro.props;

// Map delay to the closest available delay class
let delayClass = "";
if (delay > 0) {
  const delays = [200, 400, 600, 800, 1000, 1200, 1400];
  const closest = delays.reduce((prev, curr) => 
    Math.abs(curr - delay) < Math.abs(prev - delay) ? curr : prev
  );
  delayClass = `delay-${closest}`;
}

const visibilityClass = onlyWhenVisible ? "visibility-trigger" : "";
---

<div class:list={["fade-up", delayClass, visibilityClass, className]}>
  <slot />
</div>

{onlyWhenVisible && (
  <script>
    // Add intersection observer logic to trigger animation only when element enters viewport
    document.addEventListener("DOMContentLoaded", () => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add("animate");
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      
      document.querySelectorAll(".visibility-trigger").forEach(el => {
        observer.observe(el);
      });
    });
  </script>
)} 