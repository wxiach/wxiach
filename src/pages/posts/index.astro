---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import PostItem from "@/components/PostItem.astro";
import FadeInElement from "@/components/FadeInElement.astro";

const posts = await getCollection("blog");

const postsByYear = posts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .reduce(
    (acc, post) => {
      const year = new Date(post.data.date).getFullYear();
      if (!acc[year]) {
        acc[year] = [];
      }
      acc[year].push(post);
      return acc;
    },
    {} as Record<number, Awaited<ReturnType<typeof getCollection>>>,
  );
---

<Layout siteSubTitle="文章">
  <FadeInElement delay={200}>
    <p>目前已经写了 {posts.length} 篇文章，继续加油吧~~😊</p>
  </FadeInElement>
  <div class="flex flex-col gap-16">
    {
      Object.entries(postsByYear)
        .sort(([a], [b]) => Number(b) - Number(a))
        .map(([year, posts], index) => (
          <FadeInElement delay={((index + 2) * 200) as 200 | 400 | 600 | 800 | 1000 | 1200 | 1400}>
            <section class="flex flex-col gap-4">
              <h2 class="mb-6 text-3xl font-light tracking-wide text-zinc-400">
                <span class="font-medium text-zinc-700">{year}</span>
              </h2>
              <ul class="flex flex-col gap-4">
                {posts.map((post) => (
                  <PostItem id={post.id} data={post.data} />
                ))}
              </ul>
            </section>
          </FadeInElement>
        ))
    }
  </div>
</Layout>
